<%- include('partials/header', {
  titulo: 'Dashboard',
  subtitulo: 'Vis√£o geral do seu sistema',
  user: locals.user
}) %>

<div class="stats">
  <div class="stat-card">
    <h3><%= totalProdutos %></h3>
    <p>Total de Produtos</p>
  </div>
  <div class="stat-card">
    <h3><%= totalEmEstoque.toLocaleString() %></h3>
    <p>Unidades em Estoque</p>
  </div>
  <div class="stat-card">
    <h3>R$ <%= valorEstoque.toLocaleString('pt-BR', {minimumFractionDigits: 2}) %></h3>
    <p>Valor do Estoque</p>
  </div>
  <div class="stat-card">
    <h3><%= alertas.length %></h3>
    <p>Alertas de Estoque</p>
  </div>
</div>

<% if (alertas.length > 0) { %>
<div class="card">
  <h2>‚ö†Ô∏è Alertas de Estoque Baixo</h2>
  <div class="alert alert-warning">
    <strong>Produtos com estoque abaixo do m√≠nimo:</strong>
    <% alertas.forEach(p => { %>
      <br><%= `${p.codigo} - ${p.descricao} (Saldo: ${p.saldo_atual}, M√≠nimo: ${p.estoque_minimo})` %>
    <% }) %>
  </div>
</div>
<% } %>

<div class="card">
  <h2>üìù Cadastrar Novo Produto</h2>
  <form action="/produtos" method="POST">
    <div class="form-row">
        <div class="form-group">
          <label for="codigo">C√≥digo *</label>
          <input type="text" id="codigo" name="codigo" required>
        </div>
        <div class="form-group">
          <label for="descricao">Descri√ß√£o *</label>
          <input type="text" id="descricao" name="descricao" required>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="unidade">Unidade</label>
          <select id="unidade" name="unidade">
            <option value="UN">Unidade</option>
            <option value="KG">Quilograma</option>
            <option value="LT">Litro</option>
            <option value="MT">Metro</option>
            <option value="CX">Caixa</option>
          </select>
        </div>
        <div class="form-group">
          <label for="categoria">Categoria</label>
          <input type="text" id="categoria" name="categoria" list="categorias">
          <datalist id="categorias">
            <% categorias.forEach(cat => { %>
                <option value="<%= cat %>">
            <% }) %>
          </datalist>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="estoque_minimo">Estoque M√≠nimo</label>
          <input type="number" id="estoque_minimo" name="estoque_minimo" min="0" value="0">
        </div>
        <div class="form-group">
          <label for="preco_custo">Pre√ßo de Custo (R$)</label>
          <input type="number" id="preco_custo" name="preco_custo" step="0.01" min="0">
        </div>
      </div>
      <button type="submit" class="btn">Cadastrar Produto</button>
  </form>
</div>

<div class="card">
  <h2>üìã Produtos Cadastrados</h2>
  <div class="produtos-grid">
    <% produtos.forEach(produto => { %>
      <div class="produto-card">
        <div class="produto-header">
          <div class="produto-codigo"><%= produto.codigo %></div>
          <div class="produto-saldo <%= produto.saldo_atual > 0 ? 'saldo-positivo' : produto.saldo_atual === 0 ? 'saldo-zero' : 'saldo-negativo' %>"><%= produto.saldo_atual %></div>
        </div>
        <h3><%= produto.descricao %></h3>
        <p><strong>Unidade:</strong> <%= produto.unidade || 'UN' %></p>
        <% if (produto.categoria) { %><p><strong>Categoria:</strong> <%= produto.categoria %></p><% } %>
        <p><strong>Estoque M√≠nimo:</strong> <%= produto.estoque_minimo || 0 %></p>
        <% if (produto.preco_custo) { %><p><strong>Pre√ßo:</strong> R$ <%= parseFloat(produto.preco_custo).toLocaleString('pt-BR', {minimumFractionDigits: 2}) %></p><% } %>
        <% if (produto.saldo_atual <= produto.estoque_minimo) { %><span class="badge badge-warning">Estoque Baixo</span><% } %>
      </div>
    <% }) %>
  </div>
</div>

<%- include('partials/footer') %>