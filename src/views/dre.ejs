<%- include('partials/header', {
  titulo: 'DRE - Demonstrativo de Resultado',
  subtitulo: `VisÃ£o geral para o ano de ${ano}`,
  user: locals.user
}) %>

<div class="nav">
    <a href="/financeiro/completo">ðŸ“Š Fluxo de Caixa</a>
    <a href="/financeiro/faturamento">ðŸ§¾ Faturamento</a>
    <a href="/financeiro/dre">ðŸ“ˆ DRE</a>
</div>

<div class="card">
  <h2>ðŸ“ˆ DRE Gerencial - <%= ano %></h2>
  <div style="overflow-x: auto;">
    <table class="table mt-2">
      <thead>
        <tr>
          <th>DescriÃ§Ã£o</th>
          <% meses.forEach(mes => { %><th class="text-right"><%= mes %></th><% }) %>
          <th class="text-right">Total Ano</th>
        </tr>
      </thead>
      <tbody>
        <%
          const renderRow = (label, values, isHeader = false, cssClass = '', isSubItem = false) => {
            const total = values.reduce((a, b) => a + b, 0);
        %>
          <tr class=" <%= isHeader ? 'dre-header-row' : '' %> <%= cssClass %> ">
            <td><span class=" <%= isSubItem ? 'dre-sub-item' : '' %> "><%= label %></span></td>
            <% for (let i = 0; i < 12; i++) { %>
              <td class="text-right <%= values[i] < 0 ? 'saldo-negativo' : '' %>">
                <%= values[i] !== 0 ? `R$ ${values[i].toLocaleString('pt-BR', {minimumFractionDigits: 2})}` : '-' %>
              </td>
            <% } %>
            <td class="text-right <%= total < 0 ? 'saldo-negativo' : '' %>">
              <strong><%= total !== 0 ? `R$ ${total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}` : '-' %></strong>
            </td>
          </tr>
        <% } %>

        <%- renderRow('Receita Bruta de Vendas', relatorio.map(r => r.receitaBruta), true, 'dre-total-l1') %>
        <%- renderRow('DeduÃ§Ãµes da Receita Bruta', relatorio.map(r => -r.deducoes), false, '', true) %>
        <%- renderRow('Receita LÃ­quida de Vendas', relatorio.map(r => r.receitaLiquida), true, 'dre-total-l1') %>
        <%- renderRow('Custos Operacionais', relatorio.map(r => -r.custos), false, '', true) %>
        <%- renderRow('Lucro Bruto', relatorio.map(r => r.lucroBruto), true, 'dre-total-l2') %>
        <%- renderRow('Despesas Operacionais', relatorio.map(r => -r.despesasOperacionais), false, '', true) %>
        <%- renderRow('Lucro / PrejuÃ­zo Operacional', relatorio.map(r => r.lucroOperacional), true, 'dre-total-l1') %>
        <%- renderRow('Resultado Financeiro', relatorio.map(r => r.resultadoFinanceiro), false, '', true) %>
        <%- renderRow('Resultado NÃ£o Operacional', relatorio.map(r => r.resultadoNaoOperacional), false, '', true) %>
        <%- renderRow('Resultado Antes dos Impostos', relatorio.map(r => r.resultadoAntesImpostos), true, 'dre-total-l3') %>
        <%- renderRow('Imposto de Renda e ContribuiÃ§Ã£o Social', relatorio.map(r => -r.impostoLucro), false, '', true) %>
        <%- renderRow('Lucro / PrejuÃ­zo Final', relatorio.map(r => r.lucroLiquido), true, 'dre-total-final') %>

      </tbody>
    </table>
  </div>
</div>

<%- include('partials/footer') %>