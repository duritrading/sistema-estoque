<%- include('partials/header', {
  titulo: 'RelatÃ³rio RCA',
  subtitulo: 'Performance de vendas por representante',
  user: locals.user
}) %>

<div class="card">
  <h2>ðŸ“ˆ RelatÃ³rio de Performance por RCA</h2>
  <p>AnÃ¡lise de vendas, quantidades e faturamento por representante no perÃ­odo selecionado.</p>

  <form method="GET" action="/rca" class="filter-section">
    <div class="form-row">
      <div class="form-group">
        <label for="data_inicio">De:</label>
        <input type="date" name="data_inicio" id="data_inicio" class="form-control" value="<%= locals.filtros ? filtros.data_inicio : '' %>">
      </div>
      <div class="form-group">
        <label for="data_fim">AtÃ©:</label>
        <input type="date" name="data_fim" id="data_fim" class="form-control" value="<%= locals.filtros ? filtros.data_fim : '' %>">
      </div>
      <div class="form-group" style="align-self: flex-end;">
        <button type="submit" class="btn">Filtrar</button>
      </div>
    </div>
  </form>

  <div style="overflow-x: auto;">
    <table class="table mt-2">
      <thead>
        <tr>
          <th>RCA</th>
          <th class="text-right">NÂº de Vendas</th>
          <th class="text-right">Quantidade Vendida</th>
          <th class="text-right">Faturamento Total</th>
        </tr>
      </thead>
      <tbody>
        <% if (relatorio.length === 0) { %>
          <tr>
            <td colspan="4" class="text-center">Nenhum dado encontrado para o perÃ­odo selecionado.</td>
          </tr>
        <% } else { %>
          <% relatorio.forEach(item => { %>
            <tr>
              <td><strong><%= item.rca %></strong></td>
              <td class="text-right"><%= item.total_vendas %></td>
              <td class="text-right"><%= parseFloat(item.quantidade_total).toLocaleString('pt-BR') %></td>
              <td class="text-right">R$ <%= parseFloat(item.faturamento_total).toLocaleString('pt-BR', { minimumFractionDigits: 2 }) %></td>
            </tr>
          <% }) %>
        <% } %>
      </tbody>
      <tfoot>
        <% 
          const totalVendasGeral = relatorio.reduce((sum, item) => sum + parseInt(item.total_vendas), 0);
          const totalQuantidadeGeral = relatorio.reduce((sum, item) => sum + parseFloat(item.quantidade_total), 0);
          const totalFaturamentoGeral = relatorio.reduce((sum, item) => sum + parseFloat(item.faturamento_total), 0);
        %>
        <tr style="font-weight: bold; background-color: #f8f9fa;">
            <td><strong>TOTAIS</strong></td>
            <td class="text-right"><%= totalVendasGeral.toLocaleString('pt-BR') %></td>
            <td class="text-right"><%= totalQuantidadeGeral.toLocaleString('pt-BR') %></td>
            <td class="text-right">R$ <%= totalFaturamentoGeral.toLocaleString('pt-BR', {minimumFractionDigits: 2}) %></td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<%- include('partials/footer') %>